<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="docTitle" data-ar="Ù…Ø¯ÙˆÙ†Ø© - Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©" data-en="Blog - Specialized Triple">Ù…Ø¯ÙˆÙ†Ø© - Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©</title>

  <!-- ØªÙ‡ÙŠØ¦Ø© Ù…Ø¨ÙƒØ±Ø© Ù„Ù„Ù‘ØºØ© -->
  <script>
    (function(){
      var urlLang=new URLSearchParams(location.search).get('lang');
      var saved=null;try{saved=localStorage.getItem('lang')}catch(e){}
      var lang=urlLang||saved||'ar';
      document.documentElement.setAttribute('lang',lang);
      document.documentElement.setAttribute('dir','rtl'); /* Ø§ØªØ¬Ø§Ù‡ Ø«Ø§Ø¨Øª */
    })();
  </script>

  <!-- Icons / Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --brand:#ff4d00; --brand-2:#ff6a00; --ink:#333; --bg:#f8f9fa; --primary:#004aad;
      --radius:12px; --container:1200px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:"Cairo",Tahoma,Arial,sans-serif;background:var(--bg);color:var(--ink);overflow-x:hidden}

    /* ===== Top bar ===== */
    .top-bar{
      background:var(--brand-2);color:#fff;font-size:14px;padding:6px 15px;
      display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap; position:relative;
    }
    .welcome-text{font-weight:600}
    .social-lang{display:flex;align-items:center;gap:10px}
    .social-lang a{color:#fff;font-size:16px;text-decoration:none;line-height:1}

    /* WhatsApp: Ø²Ø± Ø¢ÙŠÙƒÙˆÙ† ÙÙ‚Ø· + Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø±Ù‚Ø§Ù… */
    .wa-wrap{position:relative}
    .wa-btn{
      display:inline-flex;align-items:center;justify-content:center;
      background:#0dbb4e;color:#fff;border:none;border-radius:999px;
      width:40px;height:40px;cursor:pointer;box-shadow:0 6px 16px rgba(0,0,0,.15);padding:0;
    }
    .wa-btn span{display:none}
    .wa-panel{
      position:absolute; inset-inline-end:0; inset-block-start:44px;
      background:#10243a; color:#e6f0ff; border:1px solid #274766; border-radius:14px;
      box-shadow:0 18px 40px rgba(0,0,0,.28); min-width:280px; display:none; z-index:20; overflow:hidden;
    }
    .wa-panel.open{display:block}
    .wa-sec{padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.06)}
    .wa-sec:last-child{border-bottom:0}
    .wa-title{font-weight:900; font-size:13px; color:#b4d5ff; margin:0 0 6px}
    .wa-row{display:flex; align-items:center; justify-content:space-between; gap:8px;
      background:#0b1d33; border:1px solid #1f3b5a; border-radius:10px; padding:8px 10px}
    .wa-row a{color:#8bd6ff; text-decoration:none; font-weight:800}
    .wa-row .tel{direction:ltr; unicode-bidi:bidi-override; color:#e6f0ff}

    /* Language switch */
    .lang-switch{display:inline-flex;align-items:center;gap:0}
    .lang-link{color:#fff;text-decoration:none;font-weight:800;font-size:12px;padding:1px 3px;cursor:pointer}
    .lang-link.active{border-bottom:2px solid #fff}
    .lang-sep{display:inline-block;width:1px;height:12px;background:rgba(255,255,255,.85);margin:0 8px}

    /* ===== Header/Nav ===== */
    header{background:#fff;border-bottom:3px solid var(--brand);position:sticky;top:0;z-index:10}
    .header-inner{
      max-width:var(--container);margin:0 auto;padding:10px 20px;
      display:flex;align-items:center;justify-content:space-between;gap:clamp(10px,2vw,22px);
    }
    .brand-area{display:flex;align-items:center;gap:12px}
    .logo{height:90px;width:auto;object-fit:contain;display:block}
    @media (max-width:720px){ .logo{height:70px} }
    nav ul{list-style:none;margin:0;padding:0;display:flex;gap:clamp(10px,2.5vw,26px);align-items:center}
    nav a{text-decoration:none;color:var(--ink);font-weight:700;padding:8px 10px;border-radius:8px}
    nav a:hover{background:#f2f2f2}
    nav a.active{background:#eef3ff;color:var(--primary)}

    /* ===== Controls & Grid ===== */
    .controls{max-width:var(--container);margin:18px auto 0;padding:0 20px;
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
    .search{position:relative;flex:1;min-width:240px;max-width:520px}
    .search input{width:100%;padding:12px 38px;border:1px solid #ddd;border-radius:999px;background:#fff;font:14px "Cairo",Tahoma}
    .search .fa-magnifying-glass{position:absolute;inset-inline-end:12px;top:50%;transform:translateY(-50%);color:#999}
    .filters{display:flex;gap:8px;flex-wrap:wrap}
    .chip{appearance:none;border:1px solid #e2e4ea;background:#fff;color:#222;padding:8px 12px;border-radius:999px;font-weight:700;cursor:pointer}
    .chip.active{border-color:var(--brand);color:var(--brand)}

    .grid{max-width:var(--container);margin:18px auto 40px;padding:0 20px;
      display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .card{
      background:#fff;border:1px solid #eee;border-radius:12px;overflow:hidden;
      display:flex;flex-direction:column;
      box-shadow:0 3px 10px rgba(0,0,0,.05);
      transition:transform .18s ease,box-shadow .18s ease;text-align:start
    }
    .card:hover{transform:translateY(-3px);box-shadow:0 10px 24px rgba(0,0,0,.08)}

    /* Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¹Ù„ÙˆÙŠØ©: ØªØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙÙŠ ØºÙ„Ø§Ù */
    .thumb{
      background:#f2f2f2;
      position:relative;
      overflow:hidden;
      border-bottom:1px solid #f3f4f6;
    }
    .thumb.has-img{
      aspect-ratio:16/9;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}

    .content{padding:14px 14px 16px}
    .title{font-weight:800;margin:0 0 6px;font-size:18px;color:#111;line-height:1.4}
    .excerpt{margin:0 0 10px;opacity:.9;font-size:14px;line-height:1.8}
    .meta{display:flex;gap:10px;align-items:center;opacity:.7;font-size:12px}
    .actions{margin-top:12px}
    .btn{text-decoration:none;display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;font-weight:800;
      border:1px solid #e8eaef;background:#fff;color:#222}
    .btn:hover{border-color:var(--brand);color:var(--brand)}
    .empty,.loading{max-width:900px;margin:40px auto;text-align:center;opacity:.7}

    footer{background:var(--primary);color:#fff;padding:16px 20px;text-align:center;border-top:3px solid var(--brand)}

    /* ===== Ù…ÙˆØ¨Ø§ÙŠÙ„ ===== */
    @media (max-width: 640px){
      .top-bar{ display:grid; grid-template-columns:1fr auto; gap:6px; padding:6px 10px; font-size:13px; }
      .welcome-text{ grid-column:1 / -1; white-space:normal; display:block; line-height:1.6; }
      .social-lang{
        display:flex !important; align-items:center !important; justify-content:flex-start !important;
        gap:8px !important; flex-wrap:nowrap !important;
      }
      .lang-switch{ margin-inline-start:auto !important; }

      .header-inner{ gap:8px; padding:8px 12px; flex-wrap:nowrap; }
      header nav{ flex:1; min-width:0; }
      header nav ul{
        display:flex !important; flex-wrap: wrap !important; overflow: visible !important; white-space: normal !important;
        gap:6px !important; padding-block:2px !important; margin:0 !important;
      }
      header nav a{ padding:5px 7px !important; font-size:12px !important; border-radius:8px !important; line-height:1.2 !important; }
      .logo{ height:56px; }
    }
  </style>
</head>
<body>

  <!-- ===== Top bar ===== -->
  <div class="top-bar">
    <div class="welcome-text"
         data-ar="Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ <strong>Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©</strong> â€“ Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­ Ù„ØªØ¨Ø³ÙŠØ· Ø£Ø¹Ù…Ø§Ù„ÙƒÙ…"
         data-en="Welcome to the <strong>Specialized Triple Blog</strong> â€” latest insights and tips to simplify your business">
      Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒÙ… ÙÙŠ <strong>Ù…Ø¯ÙˆÙ†Ø© Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©</strong> â€“ Ø£Ø­Ø¯Ø« Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª ÙˆØ§Ù„Ù†ØµØ§Ø¦Ø­ Ù„ØªØ¨Ø³ÙŠØ· Ø£Ø¹Ù…Ø§Ù„ÙƒÙ…
    </div>

    <div class="social-lang">
      <a href="https://www.instagram.com/tholatheya?igsh=bnp0Nzh4a2tiY29i" target="_blank" rel="noopener" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
      <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>

      <div class="wa-wrap">
        <button class="wa-btn" id="waBtn" aria-haspopup="true" aria-expanded="false" title="WhatsApp">
          <i class="fab fa-whatsapp"></i><span data-ar="ÙˆØ§ØªØ³Ø§Ø¨" data-en="WhatsApp">ÙˆØ§ØªØ³Ø§Ø¨</span>
        </button>
        <div class="wa-panel" id="waPanel" role="menu" aria-label="WhatsApp numbers">
          <div class="wa-sec">
            <div class="wa-title" data-ar="Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª" data-en="Inquiries">Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª</div>
            <div class="wa-row">
              <a href="https://wa.me/962793383398" target="_blank" rel="noopener"><i class="fab fa-whatsapp"></i> WhatsApp</a>
              <a class="tel" href="tel:+962793383398">+962 793383398</a>
            </div>
          </div>
          <div class="wa-sec">
            <div class="wa-title" data-ar="Ù…Ø¨ÙŠØ¹Ø§Øª" data-en="Sales">Ù…Ø¨ÙŠØ¹Ø§Øª</div>
            <div class="wa-row">
              <a href="https://wa.me/962797664441" target="_blank" rel="noopener"><i class="fab fa-whatsapp"></i> WhatsApp</a>
              <a class="tel" href="tel:+962797664441">+962 797664441</a>
            </div>
          </div>
          <div class="wa-sec">
            <div class="wa-title" data-ar="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©" data-en="Administration">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
            <div class="wa-row">
              <a href="https://wa.me/962799104601" target="_blank" rel="noopener"><i class="fab fa-whatsapp"></i> WhatsApp</a>
              <a class="tel" href="tel:+962799104601">+962 799104601</a>
            </div>
          </div>
        </div>
      </div>

      <a href="https://www.linkedin.com/company/109431975/" target="_blank" rel="noopener" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>

      <div class="lang-switch" aria-label="Language switcher">
        <a href="#" class="lang-link" id="link-en">EN</a>
        <span class="lang-sep" aria-hidden="true"></span>
        <a href="#" class="lang-link" id="link-ar">AR</a>
      </div>
    </div>
  </div>

  <!-- ===== Header ===== -->
  <header>
    <div class="header-inner">
      <div class="brand-area">
        <a id="homeLink" href="../index.html" aria-label="Back to home">
          <img class="logo" src="../logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ© / Company Logo">
        </a>
      </div>

      <nav aria-label="Main navigation">
        <ul>
          <li><a href="../index.html#home"        data-ar="Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" data-en="Home">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
          <li><a href="../about.html"             data-ar="Ù…Ù† Ù†Ø­Ù†"          data-en="About">Ù…Ù† Ù†Ø­Ù†</a></li>
          <li><a href="../index.html#categories"  data-ar="Ø§Ù„ÙØ¦Ø§Øª"          data-en="Categories">Ø§Ù„ÙØ¦Ø§Øª</a></li>
          <li><a href="../index.html#brands"      data-ar="Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª"        data-en="Brands">Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª</a></li>
          <li><a href="../index.html#locations"   data-ar="Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹"         data-en="Locations">Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</a></li>
          <li><a href="./index.html" class="active" data-ar="Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©"       data-en="Blog">Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©</a></li>
          <li><a href="../index.html#contact"     data-ar="ØªÙˆØ§ØµÙ„"           data-en="Contact">ØªÙˆØ§ØµÙ„</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- ===== Controls ===== -->
  <div class="controls">
    <div class="search">
      <input id="q" type="search" placeholder="" data-ar-ph="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª" data-en-ph="Search articles">
      <i class="fa-solid fa-magnifying-glass"></i>
    </div>
    <div class="filters">
      <button class="chip active" data-filter="all"      data-ar="Ø§Ù„ÙƒÙ„"    data-en="All">Ø§Ù„ÙƒÙ„</button>
      <button class="chip"         data-filter="tips"     data-ar="Ù†ØµØ§Ø¦Ø­"  data-en="Tips">Ù†ØµØ§Ø¦Ø­</button>
      <button class="chip"         data-filter="news"     data-ar="Ø£Ø®Ø¨Ø§Ø±"  data-en="News">Ø£Ø®Ø¨Ø§Ø±</button>
      <button class="chip"         data-filter="projects" data-ar="Ù…Ø´Ø§Ø±ÙŠØ¹" data-en="Projects">Ù…Ø´Ø§Ø±ÙŠØ¹</button>
    </div>
  </div>

  <!-- ===== Posts Grid ===== -->
  <main class="grid" id="grid"></main>
  <div id="loading" class="loading" data-ar="Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª..." data-en="Loading posts">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª...</div>
  <div id="empty" class="empty" style="display:none" data-ar="Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†." data-en="No posts yet">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>

  <footer>
    <p data-ar="Â© 2025 Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© | Specialized Triple" data-en="Â© 2025 Specialized Triple">Â© 2025 Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© | Specialized Triple</p>
  </footer>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    let activeLang='ar';

    function setTitleByLang(lang){
      const tEl=document.getElementById('docTitle');
      if(!tEl) return;
      const ar=tEl.getAttribute('data-ar')||'Ù…Ø¯ÙˆÙ†Ø© - Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©';
      const en=tEl.getAttribute('data-en')||'Blog - Specialized Triple';
      tEl.textContent=(lang==='ar')?ar:en;
    }
    function applyPlaceholders(lang){
      document.querySelectorAll('[data-ar-ph]').forEach(el=>{
        const ph=(lang==='ar')?el.getAttribute('data-ar-ph'):el.getAttribute('data-en-ph');
        if(ph!=null) el.setAttribute('placeholder',ph);
      });
    }
    function rewriteInternalLinks(lang){
      document.querySelectorAll('a[href]').forEach(a=>{
        const href=a.getAttribute('href'); if(!href) return;
        if(href.startsWith('#') || /^(https?:|mailto:|tel:|javascript:)/i.test(href)) return;
        const url=new URL(href,location.href); url.searchParams.set('lang',lang);
        a.setAttribute('href',url.pathname+url.search+url.hash);
      });
    }
    function setLang(lang){
      activeLang=lang;
      document.documentElement.setAttribute('lang',lang);
      document.documentElement.setAttribute('dir','rtl');
      document.querySelectorAll('[data-ar]').forEach(el=>{
        const v=(lang==='ar')?el.getAttribute('data-ar'):el.getAttribute('data-en');
        if(v!=null) el.innerHTML=v;
      });
      setTitleByLang(lang);
      applyPlaceholders(lang);

      const linkAr=document.getElementById('link-ar');
      const linkEn=document.getElementById('link-en');
      if(linkAr&&linkEn){linkAr.classList.toggle('active',lang==='ar');linkEn.classList.toggle('active',lang==='en');}

      try{localStorage.setItem('lang',lang);}catch(e){}
      rewriteInternalLinks(lang);

      if (window.__CB_LANG_UPDATE__) window.__CB_LANG_UPDATE__(lang);
      renderPosts();
    }

    function syncHomeLinks(initial){
      const homeLink=document.getElementById('homeLink');
      if(homeLink){
        const url=new URL(homeLink.getAttribute('href'),location.href);
        url.searchParams.set('lang',initial);
        homeLink.setAttribute('href',url.pathname+url.search+url.hash);
      }
    }

    document.addEventListener('DOMContentLoaded',()=>{
      const linkAr=document.getElementById('link-ar');
      const linkEn=document.getElementById('link-en');
      if(linkAr) linkAr.addEventListener('click',e=>{e.preventDefault();setLang('ar')});
      if(linkEn) linkEn.addEventListener('click',e=>{e.preventDefault();setLang('en')});

      const urlLang=new URLSearchParams(location.search).get('lang');
      const saved=(()=>{try{return localStorage.getItem('lang')}catch(e){return null}})();
      const initial=urlLang||saved||'ar';
      syncHomeLinks(initial);
      setLang(initial);
    });

    /* ===== Firebase (read-only) ===== */
    let db=null;
    const firebaseConfig={
      apiKey:"AIzaSyBtihtuZ3eq54h4q4Acmakr8mgeZJO-hRI",
      authDomain:"tholatheya-blog.firebaseapp.com",
      projectId:"tholatheya-blog",
      storageBucket:"tholatheya-blog.firebasestorage.app",
      messagingSenderId:"754772585101",
      appId:"1:754772585101:web:cd9b8e1307456af3c450c4",
      measurementId:"G-KGCEH7E26G"
    };
    try{
      if(firebaseConfig.apiKey&&firebaseConfig.apiKey!=="PASTE_YOUR_API_KEY"){
        firebase.initializeApp(firebaseConfig);
        db=firebase.firestore();
      }else{db=null}
    }catch(e){db=null}

    const state={posts:[],filter:'all',q:''};
    const gridEl=document.getElementById('grid');
    const loadingEl=document.getElementById('loading');
    const emptyEl=document.getElementById('empty');

    document.getElementById('q').addEventListener('input',e=>{
      state.q=e.target.value.trim().toLowerCase();
      renderPosts();
    });
    document.querySelectorAll('.chip').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.chip').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        state.filter=btn.dataset.filter||'all';
        renderPosts();
      });
    });

    async function fetchPosts(){
      loadingEl.style.display='block';
      emptyEl.style.display='none';
      gridEl.innerHTML='';
      try{
        if(!db){ state.posts=[]; }
        else{
          const snap=await db.collection('posts').orderBy('publishedAt','desc').get();
          state.posts=snap.docs.map(d=>({id:d.id,...d.data()}));
        }
      }catch(err){
        state.posts=[];
      }finally{
        loadingEl.style.display='none';
        renderPosts();
      }
    }

    function formatDate(ts){
      try{
        const d=ts?.toDate?ts.toDate():new Date(ts);
        const opts={year:'numeric',month:'short',day:'numeric'};
        return new Intl.DateTimeFormat(activeLang==='ar'?'ar-JO':'en-US',opts).format(d);
      }catch{return ''}
    }

    function renderPosts(){
      const posts=Array.isArray(state.posts)?state.posts:[];
      const q=state.q, f=state.filter;

      const filtered=posts.filter(p=>{
        const okFilter=(f==='all')?true:(Array.isArray(p.tags)?p.tags.includes(f):false);
        const title=(activeLang==='ar'?p.title_ar:p.title_en)||'';
        const ex   =(activeLang==='ar'?p.excerpt_ar:p.excerpt_en)||'';
        const okSearch=!q||title.toLowerCase().includes(q)||ex.toLowerCase().includes(q);
        return okFilter&&okSearch;
      });

      gridEl.innerHTML='';
      if(!filtered.length){ emptyEl.style.display='block'; return; }
      emptyEl.style.display='none';

      filtered.forEach(p=>{
        const title=(activeLang==='ar'?p.title_ar:p.title_en)||'';
        const ex   =(activeLang==='ar'?p.excerpt_ar:p.excerpt_en)||'';
        const date =formatDate(p.publishedAt);
        const slug =p.slug||p.id||'';
        const url  =new URL(`post.html?slug=${encodeURIComponent(slug)}`,location.href);
        url.searchParams.set('lang',activeLang);
        const href =url.pathname+url.search+url.hash;

        const card=document.createElement('article');
        card.className='card';

        const cover=p.coverUrl ? p.coverUrl.trim() : '';

        // Ø¥Ø°Ø§ ÙÙŠ ØºÙ„Ø§ÙØŒ Ø¨Ù†Ø¹Ø±Ø¶Ù‡Ø› Ø¥Ø°Ø§ Ù„Ø§ØŒ Ù…Ø§ Ø¨Ù†Ø­Ø· Ø¨ÙˆÙƒØ³ Ø£ØµÙ„Ø§Ù‹
        if(cover){
          const thumb=document.createElement('div');
          thumb.className='thumb has-img';
          thumb.innerHTML=`<img src="${cover}" alt="" loading="lazy" decoding="async">`;
          card.appendChild(thumb);
        }

        const content=document.createElement('div');
        content.className='content';
        content.innerHTML=`
          <h3 class="title" data-ar="${title}" data-en="${title}">${title}</h3>
          <p class="excerpt" data-ar="${ex}" data-en="${ex}">${ex}</p>
          <div class="meta"><i class="fa-regular fa-calendar"></i><span>${date}</span></div>
          <div class="actions">
            <a class="btn" href="${href}">
              <i class="fa-solid fa-book-open"></i>
              <span data-ar="Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯" data-en="Read more">${activeLang==='ar'?'Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯':'Read more'}</span>
            </a>
          </div>
        `;

        card.appendChild(content);
        gridEl.appendChild(card);
      });
    }

    fetchPosts();

    /* ===== WhatsApp dropdown ===== */
    function initWhatsAppPanel(){
      const btn=document.getElementById('waBtn');
      const panel=document.getElementById('waPanel');
      if(!btn || !panel) return;
      btn.addEventListener('click', ()=>{
        const open=panel.classList.toggle('open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
      document.addEventListener('click', (e)=>{
        const inside=e.target.closest('#waPanel')||e.target.closest('#waBtn');
        if(!inside) panel.classList.remove('open');
      });
    }
    initWhatsAppPanel();
  </script>

  <!-- ===== ChatBot Widget ===== -->
  <style>
    :root{ --cb-brand: var(--brand, #ff4d00); --cb-primary: var(--primary, #004aad); --cb-ink: var(--ink, #333); }
    .cb-fab{ position: fixed; inset-inline-end: 18px; bottom: 18px; z-index: 9999; }
    .cb-fab button{
      background: var(--cb-brand); color:#fff; border:none; border-radius:999px;
      padding:12px 16px; font-weight:900; display:flex; gap:10px; align-items:center;
      box-shadow:0 12px 28px rgba(0,0,0,.22); cursor:pointer;
    }
    .cb-panel{
      position: fixed; inset-inline-end: 18px; bottom: 78px; width: min(380px, 92vw);
      background:#fff; border:1px solid #e6ebf2; border-radius:16px; overflow:hidden;
      box-shadow:0 18px 40px rgba(0,0,0,.18); display:none; z-index: 9999; direction: rtl;
      height: min(520px, 75vh);
    }
    .cb-panel.open{ display: grid; grid-template-rows: auto 1fr auto auto; }
    .cb-head{ background: linear-gradient(90deg, rgba(0,74,173,.10), rgba(0,74,173,.06));
      border-bottom:1px solid #dfe7f5; padding:10px 12px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .cb-head .title{font-weight:900; color:#0f172a; display:flex; align-items:center; gap:8px}
    .cb-head .title i{color: var(--cb-primary)}
    .cb-head .right-actions{ display:flex; align-items:center; gap:8px }
    .cb-head .ghost{ background:#fff; color:#0f172a; border:1px solid #e6ebf2; border-radius:999px; padding:6px 10px; font-weight:800; cursor:pointer; font-size:12px; }
    .cb-body{ background:#f8fafc; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:10px }
    .cb-msg{ display:flex; gap:8px; align-items:flex-end }
    .cb-msg.me{ justify-content:flex-start; }
    .cb-msg.bot{ justify-content:flex-end; }
    .cb-bubble{ padding:10px 12px; border-radius:14px; max-width:80%; line-height:1.8; font-size:14px; box-shadow:0 2px 6px rgba(0,0,0,.07); }
    .cb-msg.me  .cb-bubble{ background:#fff; border:1px solid #e6ebf2; color:#0f172a }
    .cb-msg.bot .cb-bubble{ background: var(--cb-brand); color:#fff; border:1px solid rgba(0,0,0,.06) }

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„Ø£Ø²Ø±Ù‚ Ø§Ù„ÙˆØ§Ø¶Ø­ */
    .cb-suggests-wrap{
      border-top:1px solid #edf1f6;
      background:#e6f0ff;
      padding:8px 0;
      display:grid;
      grid-template-rows:auto;
    }
    .cb-suggests{
      display:flex; gap:8px; align-items:center;
      overflow-x:auto; overflow-y:hidden; white-space:nowrap; padding:0 10px 6px;
      scroll-snap-type:x proximity;
      direction: rtl;
    }
    .cb-suggests::-webkit-scrollbar{ height:8px }
    .cb-suggests::-webkit-scrollbar-thumb{ background:#e6ebf2; border-radius:999px }

    .cb-chip{
      border:1px solid var(--cb-brand);
      background:rgba(255,77,0,.08);
      color:#0f172a;
      padding:7px 12px;
      border-radius:999px;
      font-weight:800;
      cursor:pointer;
      font-size:12px;
      flex:0 0 auto;
      display:inline-block;
      scroll-snap-align:center;
    }

    .cb-mini-note{ font-size:11px; color:#64748b; padding:0 12px 10px; background:#fff; border-top:1px solid #edf1f6 }
    .cb-foot{ display:flex; gap:8px; padding:10px; border-top:1px solid #edf1f6; background:#fff }
    .cb-input{ flex:1; border:1px solid #dfe7f5; border-radius:999px; padding:10px 12px; font:14px "Cairo", Tahoma; background:#fff }
    .cb-send{ background: var(--cb-primary); color:#fff; border:none; border-radius:999px; padding:10px 14px; font-weight:900; cursor:pointer }
  </style>

  <div class="cb-fab">
    <button id="cbFab" aria-controls="cbPanel" aria-expanded="false"><i class="fa-solid fa-robot"></i><span id="cbFabTxt">Ø§Ø³Ø£Ù„ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©</span></button>
  </div>

  <div class="cb-panel" id="cbPanel" aria-live="polite">
    <div class="cb-head">
      <div class="title"><i class="fa-solid fa-robot"></i><span id="cbTitle">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©</span></div>
      <div class="right-actions">
        <button id="cbClose" type="button" title="Ø¥ØºÙ„Ø§Ù‚" class="ghost">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
    </div>

    <div class="cb-body" id="cbBody"></div>
    <div class="cb-suggests-wrap" id="cbSugWrap"><div class="cb-suggests" id="cbSuggests"></div></div>
    <div class="cb-mini-note" id="cbMiniNote">Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ØŒ Ø§Ù„Ø¯ÙˆØ§Ù…ØŒ Ø£Ùˆ Ø§Ù„Ø´Ø­Ù† Ù…Ù† Ø§Ù„ØµÙŠÙ† âœ¨</div>
    <div class="cb-foot">
      <input id="cbInput" class="cb-input" type="text" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." />
      <button id="cbSend" class="cb-send"><i class="fa-solid fa-paper-plane"></i></button>
    </div>
  </div>

  <script>
    (function(){
      if (window.__CB_INITED__) return;
      window.__CB_INITED__ = true;

      const USE_GEMINI = false;
      const GEMINI_ENDPOINT = '/chat';

      const $ = sel => document.querySelector(sel);
      const body   = $('#cbBody');
      const panel  = $('#cbPanel');
      const input  = $('#cbInput');
      const sendBt = $('#cbSend');
      const fabBt  = $('#cbFab');
      const fabTxt = $('#cbFabTxt');
      const closeBt= $('#cbClose');

      const sugWrap= $('#cbSugWrap');
      const sug    = $('#cbSuggests');
      const titleEl= $('#cbTitle');
      const mini   = $('#cbMiniNote');

      const STR = {
        ar: {
          fab: 'Ø§Ø³Ø£Ù„ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©',
          title: 'Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©',
          close: 'Ø¥ØºÙ„Ø§Ù‚',
          suggBtn: 'Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª',
          suggBtnHide: 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª',
          placeholder: 'Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ...',
          mini: 'Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ØŒ Ø§Ù„Ø¯ÙˆØ§Ù…ØŒ Ø£Ùˆ Ø§Ù„Ø´Ø­Ù† Ù…Ù† Ø§Ù„ØµÙŠÙ† âœ¨',
          greet: 'Ø£Ù‡Ù„Ù‹Ø§! Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ©. ÙƒÙŠÙ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯ÙƒØŸ ğŸ¤–',
          suggests: [
            'Ø´Ùˆ Ø®Ø¯Ù…Ø§ØªÙƒÙ… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŸ','ÙˆÙŠÙ† Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØŸ','Ù…ØªÙ‰ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¯ÙˆØ§Ù…ØŸ','Ù‡Ù„ Ø¨ØªØ¬Ù‡Ø²ÙˆØ§ ÙƒØ±ÙØ§Ù†Ø§ØªØŸ',
            'Ø¨Ø¯ÙŠ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù„Ù…ÙˆØ§Ø¯ ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ©','Ø¹Ù†Ø¯ÙƒÙ… Ø´Ø­Ù† Ù…Ù† Ø§Ù„ØµÙŠÙ†ØŸ','Ù‡Ù„ ØªÙˆØµÙ‘Ù„ÙˆÙ† Ù„ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§ØªØŸ',
            'Ù…Ø§ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©ØŸ','Ù‡Ù„ ÙÙŠ Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø·Ù„Ø¨ØŸ','Ù‡Ù„ ÙÙŠ Ø¶Ù…Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŸ',
            'Ù…Ù…ÙƒÙ† ÙƒØªØ§Ù„ÙˆØ¬ Ø£Ùˆ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§ØªØŸ','ÙƒÙŠÙ Ø£Ø±Ø³Ù„ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ Ø£Ùˆ Ù…ÙˆØ§ØµÙØ§ØªØŸ'
          ]
        },
        en: {
          fab: 'Ask Tholatheya',
          title: 'Tholatheya Assistant',
          close: 'Close',
          suggBtn: 'Suggestions',
          suggBtnHide: 'Hide suggestions',
          placeholder: 'Type your questionâ€¦',
          mini: 'Ask about products, locations, hours, or shipping from China âœ¨',
          greet: 'Hi! Iâ€™m the Tholatheya assistant. How can I help? ğŸ¤–',
          suggests: [
            'What are your main services?','Where is the head office?','What are your working hours?','Do you build caravans?',
            'I need a quote for electrical items','Do you ship from China?','Do you deliver across Jordan?',
            'What payment methods do you accept?','Is there a minimum order?','Is there product warranty?',
            'Can I get a brands catalog?','How do I send an RFQ/specs?'
          ]
        }
      };

      const k = (lang) => ({
        TRANSCRIPT: 'cbTranscriptHTML_'+lang,
        OPEN:       'cbIsOpen',
        GREET:      'cbGreetedOnce_'+lang
      });

      function saveTranscript(lang){ try{ localStorage.setItem(k(lang).TRANSCRIPT, body.innerHTML); }catch(e){} }
      function restoreTranscript(lang){
        let html=null; try{ html=localStorage.getItem(k(lang).TRANSCRIPT); }catch(e){}
        if(html && html.trim()){ body.innerHTML=html; body.scrollTop=body.scrollHeight; return true; }
        return false;
      }
      function setPanelOpen(v){
        panel.classList.toggle('open', !!v);
        try{ localStorage.setItem(k(activeLang).OPEN, v ? '1' : '0'); }catch(e){}
        setFabExpanded(!!v);
      }

      function appendMsg(html, who='me'){
        const row=document.createElement('div');
        row.className='cb-msg ' + (who==='bot' ? 'bot' : 'me');
        const b=document.createElement('div');
        b.className='cb-bubble';
        b.innerHTML=html;
        row.appendChild(b);
        body.appendChild(row);
        body.scrollTop=body.scrollHeight;
        saveTranscript(activeLang);
      }

      function botReplyLocal(userText){
        const t=(userText||'').trim();
        const normalized=t.replace(/[^\u0621-\u064Aa-z0-9 ]/gi,'').toLowerCase();
        const reply=(ar,en)=> appendMsg(activeLang==='ar'?ar:en,'bot');

        // ØªØ­ÙŠØ§Øª Ø¨Ø³ÙŠØ·Ø©
        if(/Ù…Ø±Ø­Ø¨Ø§|Ù…Ø±Ø­Ø¨Ù‡|Ø§Ù‡Ù„Ø§|Ø£Ù‡Ù„Ø§|Ø§Ù‡Ù„Ø§Ù‹|Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…|Ù‡Ø§ÙŠ|Ù‡Ù„Ø§|hi|hello|hey|good morning|good evening/.test(normalized)){
          return reply(
            'Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ ğŸ¤ ÙƒÙŠÙÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ',
            'Hello! ğŸ˜Š How are you today?'
          );
        }
        if(/Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡|Ø§Ù„Ø­Ù…Ø¯Ù„Ù„Ù‡|Ø¨Ø®ÙŠØ±|ØªÙ…Ø§Ù…|ÙƒÙˆÙŠØ³|Ù…Ù†ÙŠØ­/.test(normalized) && /(ÙˆØ§Ù†Øª|ÙˆØ§Ù†Øª ÙƒÙŠÙÙƒ|Ø§Ù†Øª ÙƒÙŠÙÙƒ)/.test(normalized)){
          return reply(
            'ØªÙ…Ø§Ù… Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ğŸ˜„ ÙŠØ³Ø¹Ø¯Ù†ÙŠ Ø¥Ù†Ùƒ Ø¨Ø®ÙŠØ±. ÙƒÙŠÙ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ',
            'Iâ€™m good, thanks! ğŸ˜„ Glad youâ€™re fine. How can I help you today?'
          );
        }
        if(/Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡|Ø§Ù„Ø­Ù…Ø¯Ù„Ù„Ù‡|Ø¨Ø®ÙŠØ±|ØªÙ…Ø§Ù…|ÙƒÙˆÙŠØ³|Ù…Ù†ÙŠØ­/.test(normalized)){
          return reply(
            'ÙŠØ³Ø¹Ø¯Ù†ÙŠ Ø¥Ù†Ùƒ Ø¨Ø®ÙŠØ± ğŸ˜„ ÙƒÙŠÙ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ',
            'Glad to hear youâ€™re fine ğŸ˜„ How can I help you today?'
          );
        }

        if(/Ù…Ù† Ø§Ù†ØªÙ…|Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ©|Ø´Ùˆ Ø¨ØªØ¹Ù…Ù„Ùˆ|what do you do|services|Ø®Ø¯Ù…Ø§ØªÙƒÙ…|Ø±Ø¤ÙŠØªÙƒÙ…/.test(normalized)){
          return reply(
            `<div><strong>Ø§Ù„Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ù…ØªØ®ØµØµØ©</strong> Ø´Ø±ÙƒØ© Ø£Ø±Ø¯Ù†ÙŠØ© Ù„ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ù†Ø´Ø¢Øª ÙˆØ§Ù„Ù…Ø­Ù„Ø§Øª.</div>
             <div>Ù†ÙˆÙÙ‘Ø± Ù…Ø´ØªØ±ÙŠØ§ØªØŒ Ù„ÙˆØ¬Ø³ØªÙŠØ§ØªØŒ ÙˆØªØ¬Ù‡ÙŠØ²Ø§Øª Ø®ÙÙŠÙØ© Ù…Ø¹ ØªØ³Ù„ÙŠÙ… Ø£Ø³Ø±Ø¹ ÙˆØªÙƒÙ„ÙØ© Ø£Ù‚Ù„.</div>
             <div>Ù‚Ø·Ø§Ø¹Ø§ØªÙ†Ø§: Ø­ÙƒÙˆÙ…ÙŠ/Ù…Ù†Ø¸Ù…Ø§ØªØŒ ØµÙ†Ø§Ø¹ÙŠ/ØªØ¬Ø§Ø±ÙŠØŒ ØªØ¹Ù„ÙŠÙ…ÙŠ/Ø·Ø¨ÙŠØŒ Ø¶ÙŠØ§ÙØ© ÙˆÙ…Ø®ÙŠÙ…Ø§Øª.</div>`,
            `<div><strong>Tholatheya</strong> is a Jordanian company for facility & shop preparation</div>
             <div>We provide procurement, logistics, and light fit-out with faster delivery and lower cost</div>
             <div>Sectors: Government/NGOs, Industrial/Commercial, Education/Medical, Hospitality & Camps</div>`
          );
        }
        if(/Ù…ÙˆÙ‚Ø¹|ÙˆÙŠÙ†|Ø§Ù„Ø®Ø±ÙŠØ·Ø©|hq|office|address|ÙˆÙŠÙ†ÙƒÙ…/.test(normalized)){
          return reply(
            `<div><strong>Ø§Ù„Ù…ÙƒØªØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ (Ø®Ù„Ø¯Ø§):</strong></div>
             <div>Ù…ÙƒØªØ¨ #209ØŒ Ø§Ù„Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø«Ø§Ù†ÙŠØŒ Ù…Ø¨Ù†Ù‰ 224ØŒ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ù‚Ø¯Ø³ Ø³Ù†ØªØ±ØŒ Ø´Ø§Ø±Ø¹ ÙˆØµÙÙŠ Ø§Ù„ØªÙ„ØŒ Ø¹Ù…Ù‘Ø§Ù†</div>
             <div><a target="_blank" href="https://maps.app.goo.gl/zppFTuJPjYwRm9pW8">Ø§ÙØªØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a></div>`,
            `<div><strong>Head Office (Khalda):</strong></div>
             <div>Office #209, 2nd Floor, Building 224, Al Quds Complex, Wasfi Al-Tal St, Amman</div>
             <div><a target="_blank" href="https://maps.app.goo.gl/zppFTuJPjYwRm9pW8">Open in Maps</a></div>`
          );
        }
        if(/Ø¯ÙˆØ§Ù…|Ø³Ø§Ø¹Ø§Øª|Ù…ØªÙ‰|ÙØªØ­|Ø§ØºÙ„Ø§Ù‚|opening|hours|Ù…ÙØªÙˆØ­/.test(normalized)){
          return reply(
            `<div><strong>Ø§Ù„Ø¯ÙˆØ§Ù…:</strong></div>
             <div>Ø§Ù„Ø³Ø¨Øª â€“ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡: 8:30 Øµ â€“ 5:00 Ù…</div>
             <div>Ø§Ù„Ø®Ù…ÙŠØ³: 8:30 Øµ â€“ 3:30 Ù…</div>
             <div>Ø§Ù„Ø¬Ù…Ø¹Ø©: Ù…ØºÙ„Ù‚</div>`,
            `<div><strong>Working hours:</strong></div>
             <div>Satâ€“Wed: 8:30 AM â€“ 5:00 PM</div>
             <div>Thu: 8:30 AM â€“ 3:30 PM</div>
             <div>Fri: Closed</div>`
          );
        }
        if(/Ø±Ù‚Ù…|Ù‡Ø§ØªÙ|ØªÙˆØ§ØµÙ„|Ø§ØªØµØ§Ù„|ÙˆØ§ØªØ³|whatsapp|sales|Ø§Ø³ØªØ¹Ù„Ø§Ù…/.test(normalized)){
          return reply(
            `<div><strong>Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙˆØ§ØµÙ„:</strong></div>
             <div>Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª: <a href="tel:+962793383398">+962 793383398</a> â€¢ <a target="_blank" href="https://wa.me/962793383398">WhatsApp</a></div>
             <div>Ù…Ø¨ÙŠØ¹Ø§Øª: <a href="tel:+962797664441">+962 797664441</a> â€¢ <a target="_blank" href="https://wa.me/962797664441">WhatsApp</a></div>
             <div>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: <a href="tel:+962799104601">+962 799104601</a> â€¢ <a target="_blank" href="https://wa.me/962799104601">WhatsApp</a></div>
             <div>ğŸ“§ <a href="mailto:info@tholatheya.com">info@tholatheya.com</a></div>`,
            `<div><strong>Contacts:</strong></div>
             <div>Inquiries: <a href="tel:+962793383398">+962 793383398</a> â€¢ <a target="_blank" href="https://wa.me/962793383398">WhatsApp</a></div>
             <div>Sales: <a href="tel:+962797664441">+962 797664441</a> â€¢ <a target="_blank" href="https://wa.me/962797664441">WhatsApp</a></div>
             <div>Administration: <a href="tel:+962799104601">+962 799104601</a> â€¢ <a target="_blank" href="https://wa.me/962799104601">WhatsApp</a></div>
             <div>ğŸ“§ <a href="mailto:info@tholatheya.com">info@tholatheya.com</a></div>`
          );
        }
        if(/Ø¹Ø±Ø¶ Ø³Ø¹Ø±|quotation|offer|Ø§Ø±Ø³Ù„ Ø¹Ø±Ø¶|Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡|rfq|specs|Ù…ÙˆØ§ØµÙØ§Øª/.test(normalized)){
          return reply(
            `<div>Ø£Ø±Ø³Ù„ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø£Ùˆ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø¥Ù„Ù‰:</div>
             <div>ğŸ“§ <a href="mailto:info@tholatheya.com">info@tholatheya.com</a></div>
             <div>Ø£Ùˆ ØªÙˆØ§ØµÙ„ Ù…Ø¹ <a target="_blank" href="https://wa.me/962797664441">ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</a> Ù„Ù†Ø±Ø¯ Ø³Ø±ÙŠØ¹Ù‹Ø§.</div>`,
            `<div>Please email your specs or bill of materials to:</div>
             <div>ğŸ“§ <a href="mailto:info@tholatheya.com">info@tholatheya.com</a></div>
             <div>Or contact <a target="_blank" href="https://wa.me/962797664441">Sales on WhatsApp</a> for a quick reply</div>`
          );
        }
        if(/ÙƒØ±ÙØ§Ù†|ÙƒØ±ÙØ§Ù†Ø§Øª|caravan|fabrication|fitout/.test(normalized)){
          return reply(
            `<div>Ù†Ø¹Ù…ØŒ Ù†Ù‚Ø¯Ù‘Ù… <strong>ØªØµÙ†ÙŠØ¹ ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„ÙƒØ±ÙØ§Ù†Ø§Øª</strong> Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨ (Ø¹Ø²Ù„ØŒ ÙƒÙ‡Ø±Ø¨Ø§Ø¡ØŒ Ø³Ø¨Ø§ÙƒØ©ØŒ ØªØ´Ø·ÙŠØ¨).</div>
             <div>Ø§Ø¨Ø¹Ø« Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª ÙˆØ³Ù†Ø¬Ù‡Ù‘Ø² Ù„Ùƒ Ø¹Ø±Ø¶Ù‹Ø§ Ù…Ù†Ø§Ø³Ø¨Ù‹Ø§.</div>`,
            `<div>Yes, we offer <strong>caravan fabrication & fit-out</strong> (insulation, electrical, plumbing, finishing)</div>
             <div>Send your specs and weâ€™ll prepare a tailored quote</div>`
          );
        }
        if(/Ø§Ù„ØµÙŠÙ†|ØºÙˆØ§Ù†Ø²Ùˆ|ÙŠÙŠ ÙˆÙˆ|yiwu|guangzhou|ØªÙˆØ±ÙŠØ¯|sourcing|Ø´Ø­Ù†/.test(normalized)){
          return reply(
            `<div>Ù„Ø¯ÙŠÙ†Ø§ Ù…ÙƒØ§ØªØ¨ ÙØ¹Ù‘Ø§Ù„Ø© ÙÙŠ Ø§Ù„ØµÙŠÙ†:</div>
             <div>ğŸ“ ØºÙˆØ§Ù†Ø²Ùˆ (Guangzhou) & ğŸ“ ÙŠÙŠÙˆÙˆ (Yiwu)</div>
             <div>Ù†ÙˆÙÙ‘Ø± ØªÙˆØ±ÙŠØ¯Ù‹Ø§ Ù…Ø¨Ø§Ø´Ø±Ù‹Ø§ ÙˆÙØ­Øµ Ø¬ÙˆØ¯Ø© ÙˆØ´Ø­Ù†Ù‹Ø§ Ù…ÙŠØ³Ù‘Ø±Ù‹Ø§ Ù„Ù„Ø£Ø±Ø¯Ù†.</div>`,
            `<div>We have active offices in China:</div>
             <div>ğŸ“ Guangzhou & ğŸ“ Yiwu</div>
             <div>We provide direct sourcing, QC, and streamlined shipping to Jordan</div>`
          );
        }
        if(/Ù…ÙˆØ§Ø¯|Ø§Ø¯ÙˆØ§Øª|Ø³Ø¨Ø§ÙƒØ©|ÙƒÙ‡Ø±Ø¨Ø§Ø¡|Ø³Ù„Ø§Ù…Ø©|Ø§Ù†Ø§Ø±Ø©|Ø¯Ù‡Ø§Ù†|Ù…ÙƒØªØ¨ÙŠØ©|it|Ø²Ø±Ø§Ø¹Ø©|Ù‚ÙŠØ§Ø³|Ø¨Ù†Ø§Ø¡/.test(normalized)){
          return reply(
            `<div>Ù†ÙˆÙÙ‘Ø± ØªÙˆØ±ÙŠØ¯ Ù…ÙˆØ§Ø¯ Ù…ØªÙ†ÙˆÙ‘Ø¹Ø©: ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ§Øª ÙˆØ¥Ù†Ø§Ø±Ø©ØŒ Ø³Ø¨Ø§ÙƒØ©ØŒ Ø¯Ù‡Ø§Ù†Ø§ØªØŒ Ø£Ø¯ÙˆØ§Øª Ù‚ÙŠØ§Ø³ØŒ ITØŒ Ø³Ù„Ø§Ù…Ø©ØŒ ØªÙ†Ø¸ÙŠÙØŒ Ø²Ø±Ø§Ø¹Ø©ØŒ Ù…ÙˆØ§Ø¯ Ø¨Ù†Ø§Ø¡â€¦</div>
             <div>Ø§Ø¨Ø¹Ø« Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬ Ù„Ù†ÙˆÙÙ‘Ø± Ø§Ù„Ø¨Ø¯Ø§Ø¦Ù„ ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±.</div>`,
            `<div>We supply a wide range: electrical & lighting, plumbing, paints, measuring tools, IT, safety/PPE, cleaning, agriculture, building materialsâ€¦</div>
             <div>Send your list and weâ€™ll propose options & pricing</div>`
          );
        }
        if(/Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹|Ø§Ù„Ø¯ÙØ¹|payment|visa|master|ØªØ­ÙˆÙŠÙ„|ÙƒØ§Ø´/.test(normalized)){
          return reply(
            `<div>Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…ØªØ§Ø­Ø©:</div>
             <div>â€¢ <strong>Ù†Ù‚Ø¯Ù‹Ø§</strong> Ø£Ùˆ <strong>ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠ</strong> Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ø±Ø¯Ù†.</div>
             <div>â€¢ Ø®ÙŠØ§Ø±Ø§Øª Ø£Ø®Ø±Ù‰ Ø¨Ø­Ø³Ø¨ Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§Ù„Ø§ØªÙØ§Ù‚.</div>`,
            `<div>Available payment methods:</div>
             <div>â€¢ <strong>Cash</strong> or <strong>bank transfer</strong> in Jordan</div>
             <div>â€¢ Other options depending on order value & agreement</div>`
          );
        }
        if(/Ø­Ø¯ Ø§Ø¯Ù†Ù‰|Ø­Ø¯ Ø£Ø¯Ù†Ù‰|moq|min(imum)? order/.test(normalized)){
          return reply(
            `<div>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø§Ù„ØµØºÙŠØ±Ø©.</div>
             <div>Ù„Ù„Ø´Ø­Ù† Ù…Ù† Ø§Ù„ØµÙŠÙ† Ù‚Ø¯ ÙŠÙØ·Ø¨Ù‘Ù‚ <strong>MOQ</strong> Ø­Ø³Ø¨ Ø§Ù„Ù…ØµÙ†Ø¹/Ø§Ù„Ù…Ù†ØªØ¬.</div>`,
            `<div>No minimum for small local orders</div>
             <div>For China shipments, <strong>MOQ</strong> may apply depending on manufacturer/product</div>`
          );
        }
        if(/ØªØ±ÙƒÙŠØ¨|ØµÙŠØ§Ù†Ø©|install|maintenance/.test(normalized)){
          return reply(
            `<div>Ù†ÙˆÙØ± <strong>ØªØ±ÙƒÙŠØ¨Ù‹Ø§ ÙˆØ®Ø¯Ù…Ø§Øª ØµÙŠØ§Ù†Ø©</strong> Ø®ÙÙŠÙØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹.</div>
             <div>Ø§Ø¨Ø¹Ø« Ù†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬/Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù†Ø­Ø¯Ù‘Ø¯ Ø§Ù„ØªÙˆÙÙ‘Ø± ÙˆØ§Ù„ØªÙƒÙ„ÙØ©.</div>`,
            `<div>We provide <strong>installation & light maintenance</strong> depending on project type</div>
             <div>Share product/location to confirm availability & cost</div>`
          );
        }
        if(/Ø¶Ù…Ø§Ù†|ÙƒÙØ§Ù„Ø©|Ù…Ø±ØªØ¬Ø¹|Ø§Ø³ØªØ±Ø¬Ø§Ø¹|Ø§Ø±Ø¬Ø§Ø¹|return|warranty/.test(normalized)){
          return reply(
            `<div>Ø§Ù„Ø¶Ù…Ø§Ù† ÙˆØ³ÙŠØ§Ø³Ø© Ø§Ù„Ø¥Ø±Ø¬Ø§Ø¹ <strong>ØªØ¹ØªÙ…Ø¯Ø§Ù† Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙØµÙ†Ù‘Ø¹ ÙˆÙ†ÙˆØ¹ Ø§Ù„Ù…Ù†ØªØ¬</strong>.</div>
             <div>Ù†ÙˆØ¶Ø­ Ø§Ù„Ø´Ø±ÙˆØ· Ù…Ø¹ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø£Ùˆ Ù‚Ø¨Ù„ Ø§Ù„Ø´Ø±Ø§Ø¡.</div>`,
            `<div>Warranty & returns <strong>depend on manufacturer/product</strong></div>
             <div>We clarify terms with the quote or before purchase</div>`
          );
        }
        if(/ÙƒØªØ§Ù„ÙˆØ¬|ÙƒØ§ØªØ§Ù„ÙˆØ¬|Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª|brands|catalog/.test(normalized)){
          return reply(
            `<div>Ø§Ø·Ù‘Ù„Ø¹ Ø¹Ù„Ù‰ Ù‚Ø³Ù… <a href="../index.html#brands">Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©</a> Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹.</div>
             <div>ÙˆÙ„Ùˆ Ø¨Ø¯Ùƒ ÙƒØªØ§Ù„ÙˆØ¬ Ù…Ø®ØµØµ Ø§Ø¨Ø¹Ø« Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© ÙˆÙ†Ø¬Ù‡Ù‘Ø² Ù„Ùƒ Ù…Ù„ÙÙ‹Ø§.</div>`,
            `<div>Check our <a href="../index.html#brands">Brands</a> section</div>
             <div>For a custom catalog, tell us the categories and weâ€™ll prepare a file</div>`
          );
        }
        if(/Ø®ØµÙ…|Ø¬Ù…Ù„Ø©|bulk|quantity discount/.test(normalized)){
          return reply(
            `<div>Ù†Ù‚Ø¯Ù‘Ù… <strong>Ø­Ø³ÙˆÙ…Ø§Øª Ù„Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø©</strong>.</div>
             <div>Ø§Ø¨Ø¹Ø« Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠØ© Ù„Ù†Ø­Ø³Ø¨ Ø£ÙØ¶Ù„ Ø³Ø¹Ø±.</div>`,
            `<div>We offer <strong>bulk discounts</strong></div>
             <div>Share approximate quantities for our best price</div>`
          );
        }
        if(/Ù…Ø³ØªÙˆØ¯Ø¹|warehouse|Ø§Ø³ØªÙ„Ø§Ù…|pick ?up/.test(normalized)){
          return reply(
            `<div>Ù„Ø¯ÙŠÙ†Ø§ Ù…Ø³ØªÙˆØ¯Ø¹ Ù„ÙˆØ¬Ø³ØªÙŠ â€” Ø±Ø§Ø³Ù„Ù†Ø§ Ù„ØªØ±ØªÙŠØ¨ <strong>Ù…ÙˆØ¹Ø¯ Ø§Ø³ØªÙ„Ø§Ù…</strong> Ø£Ùˆ Ø´Ø­Ù† Ù„Ù„Ø¹Ù†ÙˆØ§Ù†.</div>`,
            `<div>We have a logistics warehouse â€” contact us to arrange <strong>pickup</strong> or delivery</div>`
          );
        }

        appendMsg(
          activeLang==='ar'
          ? `Ø´ÙƒØ±Ù‹Ø§ Ù„Ø³Ø¤Ø§Ù„Ùƒ! ğŸ˜Š Ù„Ùˆ ØªÙˆØ¶Ù‘Ø­ Ø£ÙƒØ«Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (Ø§Ù„ÙƒÙ…ÙŠØ©/Ø§Ù„Ù†ÙˆØ¹/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©) Ø¨Ø®Ø¯Ù…Ùƒ Ø£Ø³Ø±Ø¹.
             <br><br>
             Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±:
             <br>Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª: <a href="tel:+962793383398">+962 793383398</a> â€¢ <a target="_blank" href="https://wa.me/962793383398">WhatsApp</a>
             <br>Ù…Ø¨ÙŠØ¹Ø§Øª: <a href="tel:+962797664441">+962 797664441</a> â€¢ <a target="_blank" href="https://wa.me/962797664441">WhatsApp</a>
             <br>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: <a href="tel:+962799104601">+962 799104601</a> â€¢ <a target="_blank" href="https://wa.me/962799104601">WhatsApp</a>
             <br>ğŸ“§ <a href="mailto:info@tholatheya.com">info@tholatheya.com</a>`
          : `Thanks! ğŸ˜Š Share more details (qty/type/city) and Iâ€™ll help faster
             <br><br>
             Direct contacts:
             <br>Inquiries: <a href="tel:+962793383398">+962 793383398</a> â€¢ <a target="_blank" href="https://wa.me/962793383398">WhatsApp</a>
             <br>Sales: <a href="tel:+962797664441">+962797664441</a> â€¢ <a target="_blank" href="https://wa.me/962797664441">WhatsApp</a>
             <br>Admin: <a href="tel:+962799104601">+962 799104601</a> â€¢ <a target="_blank" href="https://wa.me/962799104601">WhatsApp</a>
             <br>ğŸ“§ <a href="mailto:info@tholatheya.com">info@tholatheya.com</a>`
        ,'bot');
      }

      async function botReplyRemote(userText){
        try{
          const res=await fetch(GEMINI_ENDPOINT,{
            method:'POST', headers:{'Content-Type':'application/json'},
            body:JSON.stringify({
              message:userText,
              system:'You are Tholatheya assistant. Answer in the same language as the user. Be concise, helpful, and use the company details: HQ in Khalda Amman; WhatsApp/+962793383398 inquiries, +962797664441 sales, +962799104601 admin; hours Satâ€“Wed 8:30-17:00, Thu 8:30-15:30; China offices in Guangzhou and Yiwu.'
            })
          });
          const data=await res.json();
          const reply=(data && data.reply)?data.reply:(activeLang==='ar'?'Ù„Ù… ÙŠØµÙ„Ù†ÙŠ Ø±Ø¯ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.':'No response from server right now');
          appendMsg(reply,'bot');
        }catch(e){
          appendMsg(activeLang==='ar'?'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. Ø³Ø£Ø­Ø§ÙˆÙ„ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ù…Ø­Ù„ÙŠÙ‹Ø§ âœ¨':'Canâ€™t reach the server â€” Iâ€™ll help locally âœ¨','bot');
          botReplyLocal(userText);
        }
      }

      async function sendToBot(text){ if (USE_GEMINI) return botReplyRemote(text); return botReplyLocal(text); }
      function setFabExpanded(v){ if(!fabBt) return; fabBt.setAttribute('aria-expanded', v ? 'true' : 'false'); }

      function openPanel(){
        setPanelOpen(true); input && input.focus();
        let greeted=null; try{ greeted=localStorage.getItem(k(activeLang).GREET); }catch(e){}
        if(greeted!=='1'){
          setTimeout(()=> {
            appendMsg(STR[activeLang].greet,'bot');
            try{ localStorage.setItem(k(activeLang).GREET,'1'); }catch(e){}
          }, 200);
        }
      }
      function closePanel(){ setPanelOpen(false); }

      fabBt && fabBt.addEventListener('click', ()=>{ const isOpen=panel.classList.contains('open'); if(isOpen) closePanel(); else openPanel(); });
      closeBt && closeBt.addEventListener('click', closePanel);
      document.addEventListener('keydown', e=>{ if(e.key==='Escape') closePanel(); });

      function send(){
        const val=(input.value||'').trim(); if(!val) return;
        appendMsg(val,'me'); input.value=''; sendToBot(val);
      }
      sendBt && sendBt.addEventListener('click', send);
      input && input.addEventListener('keydown', e=>{ if(e.key==='Enter') send(); });

      function buildSuggests(lang){
        if(!sug) return;
        sug.innerHTML='';
        (STR[lang].suggests||[]).forEach(s=>{
          const chip=document.createElement('button');
          chip.className='cb-chip'; chip.type='button'; chip.textContent=s;
          chip.addEventListener('click', ()=>{ input.value=s; send(); });
          sug.appendChild(chip);
        });
      }
      function applyLangUI(lang){
        const L=STR[lang];
        if (fabTxt)   fabTxt.textContent   = L.fab;
        if (titleEl)  titleEl.textContent  = L.title;
        if (input)    input.placeholder    = L.placeholder;
        if (mini)     mini.textContent     = L.mini;
        buildSuggests(lang);
      }

      function initStateForLang(lang){
        body.innerHTML='';
        restoreTranscript(lang);
        // Ø¯Ø§ÙŠÙ…Ù‹Ø§ Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª ÙŠÙØªØ­ ÙˆÙ‡Ùˆ Ù…ØºÙ„Ù‚ Ø£ÙˆÙ„ Ù…Ø§ Ù†Ø¯Ø®Ù„ Ø§Ù„ØµÙØ­Ø©
        setPanelOpen(false);
        try{ localStorage.setItem(k(lang).OPEN,'0'); }catch(e){}
      }

      window.__CB_LANG_UPDATE__ = function(lang){
        activeLang = lang || (document.documentElement.getAttribute('lang') || 'ar');
        applyLangUI(activeLang);
        initStateForLang(activeLang);
      };

      activeLang = document.documentElement.getAttribute('lang') || 'ar';
      applyLangUI(activeLang);
      initStateForLang(activeLang);
    })();
  </script>
</body>
</html>
